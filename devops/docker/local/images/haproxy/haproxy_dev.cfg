frontend http
bind *:80
mode http
timeout client 5s
timeout client-fin 10s
timeout http-keep-alive 60s
timeout http-request 2s
acl host_app hdr(host) -i localhost
acl api_url path_beg -i /api/

use_backend api if api_url
use_backend app if host_app

backend app
mode http
timeout http-request 2s
timeout http-keep-alive 60s
timeout queue 5s
timeout server 5s
timeout server-fin 10s
timeout connect 2s
timeout tunnel 1h
server s4 app:80

backend api
mode http
timeout http-request 2s
timeout http-keep-alive 60s
timeout queue 5s
timeout server 5s
timeout server-fin 10s
timeout connect 2s
timeout tunnel 1h
server s5 api:80

